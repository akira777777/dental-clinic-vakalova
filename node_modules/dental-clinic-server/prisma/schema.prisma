// Prisma schema for Dental Clinic

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Patient model
model Patient {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Personal info
  firstName  String
  lastName   String
  email      String   @unique
  phone      String
  dateOfBirth DateTime?

  // Medical info
  allergies      String?
  medications    String?
  medicalHistory String?

  // Relations
  bookings Booking[]
  reviews  Review[]

  @@index([email])
  @@index([phone])
}

// Doctor model
model Doctor {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Personal info
  firstName       String
  lastName        String
  email           String   @unique
  phone           String
  photo           String?

  // Professional info
  specialization String
  education      String // JSON array for SQLite
  experience     Int // years
  licenses       String // JSON array for SQLite
  bio            String?

  // Availability
  workingDays    String // JSON array for SQLite: ["Monday", "Tuesday", ...]
  workingHours   String // "9:00-18:00"

  // Relations
  bookings Booking[]
  services DoctorService[]

  @@index([email])
  @@index([specialization])
}

// Service model
model Service {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Service info
  name        String   @unique
  slug        String   @unique
  description String
  price       Float
  duration    Int // minutes
  category    String

  // SEO
  metaTitle       String?
  metaDescription String?

  // Relations
  bookings Booking[]
  doctors  DoctorService[]

  @@index([slug])
  @@index([category])
}

// Doctor-Service relation (many-to-many)
model DoctorService {
  id        String   @id @default(cuid())
  doctorId  String
  serviceId String

  doctor  Doctor  @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@unique([doctorId, serviceId])
  @@index([doctorId])
  @@index([serviceId])
}

// Booking model
model Booking {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Booking info
  date      DateTime
  time      String
  status    String   @default("PENDING") // PENDING, CONFIRMED, COMPLETED, CANCELLED
  notes     String?

  // Relations
  patientId String
  doctorId  String
  serviceId String

  patient Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)
  doctor  Doctor  @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([patientId])
  @@index([doctorId])
  @@index([serviceId])
  @@index([date])
  @@index([status])
}

// Review model
model Review {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Review info
  rating  Int // 1-5
  comment String
  isPublished Boolean @default(false)

  // Relations
  patientId String
  patient   Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@index([patientId])
  @@index([rating])
  @@index([isPublished])
}

// Contact form submissions
model Contact {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())

  name    String
  email   String
  phone   String?
  subject String?
  message String
  status  String   @default("NEW") // NEW, RESPONDED, CLOSED

  @@index([email])
  @@index([status])
  @@index([createdAt])
}
